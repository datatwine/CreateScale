{% extends 'users/base.html' %}
{% block content %}

{% if messages %}
  <ul class="messages">
    {% for message in messages %}
      <li>{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}


<div class="thread-wrapper">
<div class="message-thread-container">
    <h2 class="thread-heading">Conversation with {{ other_user.username }}</h2>

    <div class="chat-window">
        {% if messages_qs %}
        {% for message in messages_qs %}
        <div class="chat-bubble {% if message.sender == request.user %}chat-right{% else %}chat-left{% endif %}">
            {% if message.hiring_status != 'none' %}
                <p class="chat-text">
                    <strong>Hiring Request</strong><br>
                    📅 {{ message.date }} at 🕓 {{ message.time }} <br>
                    📍 {{ message.location }} <br>
                    {% if message.hiring_status == 'pending' and message.recipient == request.user %}
                        <form method="post" style="margin-top:10px;">
                            {% csrf_token %}
                            <input type="hidden" name="message_id" value="{{ message.id }}">
                            <button type="submit" name="hiring_action" value="accept" class="styled-button">Accept</button>
                            <button type="submit" name="hiring_action" value="decline" class="styled-button">Decline</button>
                        </form>
                    {% else %}
                        <strong>Status: {{ message.hiring_status|capfirst }}</strong>
                    {% endif %}
                </p>
            {% else %}
                <p class="chat-text">{{ message.content }}</p>
            {% endif %}
            <span class="chat-timestamp">{{ message.timestamp|date:"M d, H:i" }}</span>
        </div>
    {% endfor %}
    {% endif %}
    
    
    <div class="message-form">
        <form method="post" action="{% url 'message-thread' other_user.id %}">
            {% csrf_token %}
            <textarea name="content" placeholder="Write your message here..." required></textarea>
            <button type="submit" class="styled-button">Send Message</button>
        </form>
    </div>

    
    <div class="hire-form-container">
        <h3 class="hire-form-heading">Hire {{ other_user.username }}</h3>
        <form method="post" action="{% url 'message-thread' other_user.id %}" class="hire-form">
            {% csrf_token %}
            <input type="hidden" name="hiring_request" value="true">
            <input type="date" name="date" required class="hire-input">
            <input type="time" name="time" required class="hire-input">
            <input type="text" name="location" placeholder="Enter Location" required class="hire-input">
            <button type="submit" class="hire-submit-button">Send Hiring Request</button>
        </form>
    </div>


    
    
</div>
</div>
</div>
{% endblock %}
